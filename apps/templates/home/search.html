{% extends "layouts/base.html" %}

{% block title %} 문화재 검색 {% endblock %}

<!-- Specific Page CSS goes HERE  -->
{% block stylesheets %}

{% endblock stylesheets %}

{% block content %}

    <main>

        {% include 'includes/preloader.html' %}

        <!-- Header -->
        <section class="section section-header pb-11 bg-primary text-white">
            <div class="container">
                <div class="row justify-content-center">
                    <div class="col-12 col-xl-8 text-center">
                        <h1 class="display-2 mb-3">문화재 검색</h1>
                        <p class="lead">시대별로 문화재를 검색할 수 있습니다.</p>
                    </div>
                </div>
            </div>
        </section>

        <section class="section section-lg">
            <div class="container mt-n10">
                <div class="row">
                    <div class="col-3">
                        <!-- ui-cards.html에서 가져옴-->
                        <div class="card shadow text-center">
                            <!-- Header -->
                            <div class="card-header bg-white p-3">
                                <h3 class="text-primary mt-auto mb-auto">시대</h3>
                            </div>
                            <!-- Content -->
                            <div class="card-body">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="heritage" value="selectall" onclick="selectAll(this)"><b>전체</b><br>
                                    <input class="form-check-input" type="checkbox" name="heritage" value="0" onclick="checkSelectAll(this)">석기<br>
                                    <input class="form-check-input" type="checkbox" name="heritage" value="1" onclick="checkSelectAll(this)">청동기<br>
                                    <input class="form-check-input" type="checkbox" name="heritage" value="2" onclick="checkSelectAll(this)">철기<br>
                                    <input class="form-check-input" type="checkbox" name="heritage" value="3" onclick="checkSelectAll(this)">고구려<br>
                                    <input class="form-check-input" type="checkbox" name="heritage" value="4" onclick="checkSelectAll(this)">백제<br>
                                    <input class="form-check-input" type="checkbox" name="heritage" value="5" onclick="checkSelectAll(this)">신라<br>
                                    <input class="form-check-input" type="checkbox" name="heritage" value="6" onclick="checkSelectAll(this)">가야<br>
                                    <input class="form-check-input" type="checkbox" name="heritage" value="7" onclick="checkSelectAll(this)">통일신라<br>
                                    <input class="form-check-input" type="checkbox" name="heritage" value="8" onclick="checkSelectAll(this)">고려<br>
                                    <input class="form-check-input" type="checkbox" name="heritage" value="9" onclick="checkSelectAll(this)">조선<br>
                                    <input class="form-check-input" type="checkbox" name="heritage" value="10" onclick="checkSelectAll(this)">대한제국<br>
                                    <input class="form-check-input" type="checkbox" name="heritage" value="11" onclick="checkSelectAll(this)">일제강점기<br>
                                    <input type="button" name="initCheckboxBtn" value="초기화" onclick="initCheckbox()">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 지도 -->
                    <div class="col-9">
                        <div id="map" style="width:100%; height:100%;"></div>
                    </div>

                </div>
            </div>
        </section>
        <div class="section py-0">

        </div>

    </main>

{% endblock content %}

<!-- Specific Page JS goes HERE  -->
{% block javascripts %}
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
{% include 'includes/kakaomap.html' %}
<script>
    var container = document.getElementById("map");
    var options = {
        center: new kakao.maps.LatLng(36.2683, 127.6358),
        level: 13
    };
    var map = new kakao.maps.Map(container, options);

    var clusterer = new kakao.maps.MarkerClusterer({
        map: map,
        minLevel:10
    });


    $(function() {

        $("input:checkbox[name='heritage']").click(function() {
            let checked_value = [];

            $("input:checkbox[name='heritage']").each(function(i, box) {
                if ($(box).is(":checked")) {
                     checked_value.push($(box).val());
                }
            });

            if (checked_value.length >= 0) {
                clusterer.clear();
                $.each(checked_value, function(i, value) {
                    var detail_list = {{ obj_list|safe }}[value];
                    var markers = $(detail_list).map(function(i, data) {
                        var marker = new kakao.maps.Marker({
                            position: new kakao.maps.LatLng(data.latitude, data.longitude),
                        });
                        var iwContent = '<div style="pading:5px;"><img src=' + data.imageUrl +'>'
                                            + '<h6>'+ data.ccbaMnm1 +'</h6>'
                                            + '<p>'+ data.ccbaCtcdNm + '|' + data.ccbaPcd1Nm +'</p>'
                                            + '<p>'+ data.ccmaName + ' ' + data.crltsnoNm  + '호' +'</p></div>'
                        var infowindow = new kakao.maps.InfoWindow({
                            content: iwContent,
                            removable: true
                        });
                        kakao.maps.event.addListener(marker, "click", function() {
                            infowindow.open(map, marker);
                            console.log("aa");
                        });

                        return marker;
                    });
                    clusterer.addMarkers(markers);
                });
            }
        });
    });


    function initCheckbox()  {
        const checkboxes = document.getElementsByName('heritage');
        checkboxes.forEach((checkbox) => {
            checkbox.checked = false;
        })
    };

    function checkSelectAll(checkbox)  {
        const selectall = document.querySelector('input[value="selectall"]');
        if(checkbox.checked === false)  {
            selectall.checked = false;
        }
    };

    function selectAll(selectAll)  {
        const checkboxes = document.getElementsByName('heritage');
        checkboxes.forEach((checkbox) => {
            checkbox.checked = selectAll.checked
        })
    };
</script>
{% endblock javascripts %}